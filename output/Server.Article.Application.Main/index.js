// Generated by purs version 0.13.8
"use strict";
var Control_Bind = require("../Control.Bind/index.js");
var Control_Monad_Except_Trans = require("../Control.Monad.Except.Trans/index.js");
var Data_Maybe = require("../Data.Maybe/index.js");
var Effect_Aff = require("../Effect.Aff/index.js");
var Server_Article_Type_Misc = require("../Server.Article.Type.Misc/index.js");
var update = function (h) {
    return function (patch) {
        return function (slug) {
            return function (userId) {
                return Control_Monad_Except_Trans.runExceptT(Control_Bind.bind(Control_Monad_Except_Trans.bindExceptT(Effect_Aff.monadAff))(Control_Monad_Except_Trans.ExceptT(h.findOne(new Data_Maybe.Just(userId))(slug)))(function (fallback) {
                    return Control_Bind.bind(Control_Monad_Except_Trans.bindExceptT(Effect_Aff.monadAff))(Control_Monad_Except_Trans.ExceptT(h.update(Server_Article_Type_Misc.mkRawFromPatch(fallback)(patch))(slug)))(function (updatedSlug) {
                        return Control_Monad_Except_Trans.ExceptT(h.findOne(new Data_Maybe.Just(userId))(updatedSlug));
                    });
                }));
            };
        };
    };
};
var unfavorite = function (h) {
    return function (slug) {
        return function (userId) {
            return Control_Monad_Except_Trans.runExceptT(Control_Bind.bind(Control_Monad_Except_Trans.bindExceptT(Effect_Aff.monadAff))(Control_Monad_Except_Trans.ExceptT(h.deleteFavorite(slug)(userId)))(function (s) {
                return Control_Monad_Except_Trans.ExceptT(h.findOne(new Data_Maybe.Just(userId))(s));
            }));
        };
    };
};
var favorite = function (h) {
    return function (slug) {
        return function (userId) {
            return Control_Monad_Except_Trans.runExceptT(Control_Bind.bind(Control_Monad_Except_Trans.bindExceptT(Effect_Aff.monadAff))(Control_Monad_Except_Trans.ExceptT(h.insertFavorite(slug)(userId)))(function (s) {
                return Control_Monad_Except_Trans.ExceptT(h.findOne(new Data_Maybe.Just(userId))(s));
            }));
        };
    };
};
var create = function (h) {
    return function (raw) {
        return function (userId) {
            return Control_Monad_Except_Trans.runExceptT(Control_Bind.bind(Control_Monad_Except_Trans.bindExceptT(Effect_Aff.monadAff))(Control_Monad_Except_Trans.ExceptT(h.insert(raw)(userId)))(function (s) {
                return Control_Monad_Except_Trans.ExceptT(h.findOne(new Data_Maybe.Just(userId))(s));
            }));
        };
    };
};
module.exports = {
    create: create,
    update: update,
    favorite: favorite,
    unfavorite: unfavorite
};
