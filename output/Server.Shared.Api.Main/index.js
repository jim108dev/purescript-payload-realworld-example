// Generated by purs version 0.13.8
"use strict";
var Control_Applicative = require("../Control.Applicative/index.js");
var Data_Either = require("../Data.Either/index.js");
var Data_Foldable = require("../Data.Foldable/index.js");
var Data_Functor = require("../Data.Functor/index.js");
var Data_List_Types = require("../Data.List.Types/index.js");
var Data_Monoid = require("../Data.Monoid/index.js");
var Effect_Aff = require("../Effect.Aff/index.js");
var Foreign = require("../Foreign/index.js");
var Payload_ContentType = require("../Payload.ContentType/index.js");
var Payload_Headers = require("../Payload.Headers/index.js");
var Payload_ResponseTypes = require("../Payload.ResponseTypes/index.js");
var Payload_Server_Response = require("../Payload.Server.Response/index.js");
var PointFree = require("../PointFree/index.js");
var Server_Shared_Api_Headers = require("../Server.Shared.Api.Headers/index.js");
var Shared_Util_String = require("../Shared.Util.String/index.js");
var setHeaders = function (origin) {
    return function (appResult) {
        var headers = Payload_Headers.set("Content-Type")(Payload_ContentType.json)(Server_Shared_Api_Headers.baseHeaders(origin));
        if (appResult instanceof Data_Either.Left) {
            return Data_Either.Left.create(Payload_Server_Response.setHeaders(headers)(appResult.value0));
        };
        if (appResult instanceof Data_Either.Right) {
            return Data_Either.Right.create(Payload_Server_Response.setHeaders(headers)(appResult.value0));
        };
        throw new Error("Failed pattern match at Server.Shared.Api.Main (line 60, column 31 - line 62, column 46): " + [ appResult.constructor.name ]);
    };
};
var renderEntry = Shared_Util_String.format2("\x09\x09\"{1}\": [\"{2}\"]");
var renderMessage = renderEntry("message");
var renderBody = Shared_Util_String.format1("{\x0a\x09\"errors\":{\x0a{1}\x0a\x09}\x0a}");
var renderErrorEntity = PointFree.compose2(renderBody)(renderEntry);
var renderErrorMessage = renderErrorEntity("message");
var options = function (v) {
    var headers = Payload_Headers.set("Content-Type")(Payload_ContentType.plain)(Payload_Headers.set("Content-Length")("0")(Server_Shared_Api_Headers.baseHeaders(v.guards.origin)));
    return Control_Applicative.pure(Effect_Aff.applicativeAff)(Data_Either.Right.create(Payload_Server_Response.setHeaders(headers)(Payload_Server_Response.noContent(Payload_ResponseTypes.Empty.value))));
};
var intercalate = function (dictFoldable) {
    return Data_Foldable.intercalate(dictFoldable)(Data_Monoid.monoidString)(", \x0a");
};
var defaultForeignError = "json format invalid";
var renderDefaultMessage = renderMessage(defaultForeignError);
var renderForeignError$prime$prime = function (v) {
    if (v instanceof Foreign.ForeignError) {
        return v.value0;
    };
    if (v instanceof Foreign.ErrorAtIndex) {
        return defaultForeignError;
    };
    if (v instanceof Foreign.TypeMismatch && v.value1 === "Undefined") {
        return "missing";
    };
    if (v instanceof Foreign.TypeMismatch) {
        return "Type mismatch: expected " + (v.value0 + (", found " + v.value1));
    };
    if (v instanceof Foreign.ErrorAtProperty) {
        return defaultForeignError;
    };
    throw new Error("Failed pattern match at Server.Shared.Api.Main (line 52, column 1 - line 52, column 47): " + [ v.constructor.name ]);
};
var renderForeignError$prime = function (v) {
    if (v instanceof Foreign.ForeignError) {
        return renderMessage(v.value0);
    };
    if (v instanceof Foreign.ErrorAtIndex) {
        return renderDefaultMessage;
    };
    if (v instanceof Foreign.TypeMismatch) {
        return renderDefaultMessage;
    };
    if (v instanceof Foreign.ErrorAtProperty) {
        return renderEntry(v.value0)(renderForeignError$prime$prime(v.value1));
    };
    throw new Error("Failed pattern match at Server.Shared.Api.Main (line 46, column 1 - line 46, column 46): " + [ v.constructor.name ]);
};
var renderForeignError = function (v) {
    if (v instanceof Foreign.ForeignError) {
        return renderMessage(v.value0);
    };
    if (v instanceof Foreign.ErrorAtIndex) {
        return renderDefaultMessage;
    };
    if (v instanceof Foreign.TypeMismatch) {
        return renderDefaultMessage;
    };
    if (v instanceof Foreign.ErrorAtProperty) {
        return renderForeignError$prime(v.value1);
    };
    throw new Error("Failed pattern match at Server.Shared.Api.Main (line 40, column 1 - line 40, column 45): " + [ v.constructor.name ]);
};
var renderJsonErrors = function (e) {
    return renderBody(intercalate(Data_List_Types.foldableNonEmptyList)(Data_Functor.map(Data_List_Types.functorNonEmptyList)(renderForeignError)(e)));
};
module.exports = {
    renderBody: renderBody,
    renderEntry: renderEntry,
    renderMessage: renderMessage,
    defaultForeignError: defaultForeignError,
    renderDefaultMessage: renderDefaultMessage,
    intercalate: intercalate,
    renderJsonErrors: renderJsonErrors,
    renderForeignError: renderForeignError,
    "renderForeignError'": renderForeignError$prime,
    "renderForeignError''": renderForeignError$prime$prime,
    setHeaders: setHeaders,
    options: options,
    renderErrorEntity: renderErrorEntity,
    renderErrorMessage: renderErrorMessage
};
