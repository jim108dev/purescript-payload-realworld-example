// Generated by purs version 0.13.8
"use strict";
var $foreign = require("./foreign.js");
var Control_Applicative = require("../Control.Applicative/index.js");
var Control_Bind = require("../Control.Bind/index.js");
var Control_Monad_Error_Class = require("../Control.Monad.Error.Class/index.js");
var Data_Array = require("../Data.Array/index.js");
var Data_Either = require("../Data.Either/index.js");
var Data_Function = require("../Data.Function/index.js");
var Data_Functor = require("../Data.Functor/index.js");
var Data_Maybe = require("../Data.Maybe/index.js");
var Data_Traversable = require("../Data.Traversable/index.js");
var Effect_Aff = require("../Effect.Aff/index.js");
var Effect_Aff_Compat = require("../Effect.Aff.Compat/index.js");
var Effect_Class = require("../Effect.Class/index.js");
var Query = function (x) {
    return x;
};
var query_ = function (decode) {
    return function (v) {
        return function (client) {
            return Control_Bind.bind(Effect_Aff.bindAff)(Effect_Aff_Compat.fromEffectFnAff($foreign.runQuery_(v)(client)))(function (rows) {
                return Data_Either.either(Control_Monad_Error_Class.throwError(Effect_Aff.monadThrowAff))(Control_Applicative.pure(Effect_Aff.applicativeAff))(Data_Traversable.sequence(Data_Traversable.traversableArray)(Data_Either.applicativeEither)(Data_Functor.map(Data_Functor.functorArray)(decode)(rows)));
            });
        };
    };
};
var queryValue_ = function (decode) {
    return function (v) {
        return function (client) {
            return Control_Bind.bind(Effect_Aff.bindAff)(Effect_Aff_Compat.fromEffectFnAff($foreign.runQueryValue_(v)(client)))(function (val) {
                return Data_Either.either(Control_Monad_Error_Class.throwError(Effect_Aff.monadThrowAff))((function () {
                    var $34 = Control_Applicative.pure(Effect_Aff.applicativeAff);
                    return function ($35) {
                        return $34(Data_Maybe.Just.create($35));
                    };
                })())(decode(val));
            });
        };
    };
};
var queryValue = function (decode) {
    return function (v) {
        return function (params) {
            return function (client) {
                return Control_Bind.bind(Effect_Aff.bindAff)(Effect_Aff_Compat.fromEffectFnAff($foreign.runQueryValue(v)(params)(client)))(function (val) {
                    return Control_Applicative.pure(Effect_Aff.applicativeAff)(Data_Either.either(Data_Function["const"](Data_Maybe.Nothing.value))(Data_Maybe.Just.create)(decode(val)));
                });
            };
        };
    };
};
var query = function (decode) {
    return function (v) {
        return function (params) {
            return function (client) {
                return Control_Bind.bind(Effect_Aff.bindAff)(Effect_Aff_Compat.fromEffectFnAff($foreign.runQuery(v)(params)(client)))(function (rows) {
                    return Data_Either.either(Control_Monad_Error_Class.throwError(Effect_Aff.monadThrowAff))(Control_Applicative.pure(Effect_Aff.applicativeAff))(Data_Traversable.sequence(Data_Traversable.traversableArray)(Data_Either.applicativeEither)(Data_Functor.map(Data_Functor.functorArray)(decode)(rows)));
                });
            };
        };
    };
};
var execute_ = function (v) {
    return function (client) {
        return Data_Functor["void"](Effect_Aff.functorAff)(Effect_Aff_Compat.fromEffectFnAff($foreign.runQuery_(v)(client)));
    };
};
var execute = function (v) {
    return function (params) {
        return function (client) {
            return Data_Functor["void"](Effect_Aff.functorAff)(Effect_Aff_Compat.fromEffectFnAff($foreign.runQuery(v)(params)(client)));
        };
    };
};
var defaultPoolConfig = {
    connectionTimeoutMillis: 0,
    idleTimeoutMillis: 30000,
    max: 10
};
var decodeFirst = function (decode) {
    return function (rows) {
        return Data_Functor.map(Data_Maybe.functorMaybe)(decode)(Data_Array.index(rows)(0));
    };
};
var queryOne = function (decode) {
    return function (v) {
        return function (params) {
            return function (client) {
                return Control_Bind.bind(Effect_Aff.bindAff)(Effect_Aff_Compat.fromEffectFnAff($foreign.runQuery(v)(params)(client)))(function (rows) {
                    return Data_Maybe.maybe(Control_Applicative.pure(Effect_Aff.applicativeAff)(Data_Maybe.Nothing.value))(Data_Either.either(Control_Monad_Error_Class.throwError(Effect_Aff.monadThrowAff))((function () {
                        var $36 = Control_Applicative.pure(Effect_Aff.applicativeAff);
                        return function ($37) {
                            return $36(Data_Maybe.Just.create($37));
                        };
                    })()))(decodeFirst(decode)(rows));
                });
            };
        };
    };
};
var queryOne_ = function (decode) {
    return function (v) {
        return function (client) {
            return Control_Bind.bind(Effect_Aff.bindAff)(Effect_Aff_Compat.fromEffectFnAff($foreign.runQuery_(v)(client)))(function (rows) {
                return Data_Maybe.maybe(Control_Applicative.pure(Effect_Aff.applicativeAff)(Data_Maybe.Nothing.value))(Data_Either.either(Control_Monad_Error_Class.throwError(Effect_Aff.monadThrowAff))((function () {
                    var $38 = Control_Applicative.pure(Effect_Aff.applicativeAff);
                    return function ($39) {
                        return $38(Data_Maybe.Just.create($39));
                    };
                })()))(decodeFirst(decode)(rows));
            });
        };
    };
};
var connectionInfoFromString = function (s) {
    return {
        connectionString: s
    };
};
var connectionInfoFromConfig = function (c) {
    return function (p) {
        return {
            host: c.host,
            database: c.database,
            port: c.port,
            user: c.user,
            password: c.password,
            ssl: c.ssl,
            connectionTimeoutMillis: p.connectionTimeoutMillis,
            idleTimeoutMillis: p.idleTimeoutMillis,
            max: p.max
        };
    };
};
var connect = function ($40) {
    return Effect_Aff_Compat.fromEffectFnAff($foreign["connect'"]($40));
};
var withClient = function (pool) {
    return function (p) {
        return Effect_Aff.bracket(connect(pool))((function () {
            var $41 = Effect_Class.liftEffect(Effect_Aff.monadEffectAff);
            return function ($42) {
                return $41($foreign.release($42));
            };
        })())(p);
    };
};
module.exports = {
    Query: Query,
    connectionInfoFromConfig: connectionInfoFromConfig,
    connectionInfoFromString: connectionInfoFromString,
    defaultPoolConfig: defaultPoolConfig,
    connect: connect,
    execute: execute,
    execute_: execute_,
    query: query,
    query_: query_,
    queryValue: queryValue,
    queryValue_: queryValue_,
    queryOne: queryOne,
    queryOne_: queryOne_,
    withClient: withClient,
    release: $foreign.release,
    end: $foreign.end,
    mkPool: $foreign.mkPool
};
