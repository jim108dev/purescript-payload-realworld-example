// Generated by purs version 0.13.8
"use strict";
var Data_Bifunctor = require("../Data.Bifunctor/index.js");
var Data_Either = require("../Data.Either/index.js");
var Data_Functor = require("../Data.Functor/index.js");
var Effect_Aff = require("../Effect.Aff/index.js");
var Payload_ResponseTypes = require("../Payload.ResponseTypes/index.js");
var Payload_Server_Response = require("../Payload.Server.Response/index.js");
var Server_Comment_Api_Type_CreateDto = require("../Server.Comment.Api.Type.CreateDto/index.js");
var Server_Comment_Api_Type_Misc = require("../Server.Comment.Api.Type.Misc/index.js");
var Server_Comment_Persistence_Postgres = require("../Server.Comment.Persistence.Postgres/index.js");
var Server_Comment_Type_Misc = require("../Server.Comment.Type.Misc/index.js");
var Server_Shared_Api_Main = require("../Server.Shared.Api.Main/index.js");
var renderError = function (v) {
    if (v instanceof Server_Comment_Type_Misc.NOT_FOUND) {
        return Payload_Server_Response.notFound(Server_Shared_Api_Main.renderErrorMessage("comment not found"));
    };
    if (v instanceof Server_Comment_Type_Misc.EMAIL_EXITS) {
        return Payload_Server_Response.unprocessableEntity(Server_Shared_Api_Main.renderErrorEntity("email")("exists"));
    };
    throw new Error("Failed pattern match at Server.Comment.Api.Main (line 50, column 1 - line 50, column 45): " + [ v.constructor.name ]);
};
var next = function (h) {
    return Server_Comment_Persistence_Postgres.mkHandle(h.pool.value0);
};
var get = function (h) {
    return function (v) {
        return Data_Functor.map(Effect_Aff.functorAff)(Data_Functor.map(Data_Functor.functorFn)(Data_Functor.map(Data_Functor.functorFn)(Server_Shared_Api_Main.setHeaders(v.guards.origin))(Data_Bifunctor.bimap(Data_Either.bifunctorEither)(renderError)(function ($21) {
            return Payload_Server_Response.ok(Server_Comment_Api_Type_Misc.mkMultipleDto($21));
        })))(Data_Either.Right.create))((next(h)).search(v.guards.maybeUserId)(v.params.slug));
    };
};
var $$delete = function (h) {
    return function (v) {
        return Data_Functor.map(Effect_Aff.functorAff)(Data_Functor.map(Data_Functor.functorFn)(Server_Shared_Api_Main.setHeaders(v.guards.origin))(Data_Bifunctor.bimap(Data_Either.bifunctorEither)(renderError)(function (v1) {
            return Payload_Server_Response.ok(Payload_ResponseTypes.Empty.value);
        })))((next(h))["delete"](v.params.id)(v.params.slug));
    };
};
var create = function (h) {
    return function (v) {
        return Data_Functor.map(Effect_Aff.functorAff)(Data_Functor.map(Data_Functor.functorFn)(Server_Shared_Api_Main.setHeaders(v.guards.origin))(Data_Bifunctor.bimap(Data_Either.bifunctorEither)(renderError)(function ($22) {
            return Payload_Server_Response.ok(Server_Comment_Api_Type_Misc.mkSingleDto($22));
        })))((next(h)).insert(v.guards.userId)(Server_Comment_Api_Type_CreateDto.unwrapCreateDto(v.body))(v.params.slug));
    };
};
var mkHandle = function (h) {
    return {
        create: create(h),
        "delete": $$delete(h),
        get: get(h)
    };
};
module.exports = {
    mkHandle: mkHandle,
    next: next,
    create: create,
    get: get,
    "delete": $$delete,
    renderError: renderError
};
